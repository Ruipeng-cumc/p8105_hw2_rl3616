---
title: "p8105_hw2_rl3616"
author: "Ruipeng Li"
date: "`r format(Sys.Date())`"
output: github_document
---
Loading packages. 
```{r}
library(tidyverse)
library(lubridate)      #to use parse_date_time
library(readxl)         #for problem 2
library(dplyr)          #filter
```

# Problem 1

#### Part 1
Clean the data in pols-month.csv.

```{r}
pols_df <- read_csv("data/pols-month.csv") |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), convert = TRUE) |>
  mutate(
    month = month.name[month],
    president = ifelse(prez_gop == 1, "gop", "dem")
    ) |>
  select(-prez_gop, -prez_dem, -day) |> 
  arrange(year, factor(month, levels = month.name))   #Old data to new data
```

Finished part one, let's looking at our new pols-month.

```{r}
pols_df
```

#### Part 2
clean the data in snp.csv
This is pretty complicate since we both have yyyy/m/d type of date and m/d/yy

```{r}
snp_df <- read_csv("data/snp.csv") |>
  janitor::clean_names() |>
  mutate(date = parse_date_time(date, orders = c("ymd", "mdy"))) |>     #in this way I don't need to relocate()
  separate(date, into = c("year", "month", "day"), convert = TRUE) |>
  mutate(
    year  = if_else(year > 2015, year - 100L, year),
    month = month.name[month]
    ) |> 
  select(-day) |> 
  arrange(year, factor(month, levels = month.name))   #Old data to new data
```

I found "parse_date_time()" in lubridate package can both help me clean the "ymd" and "mdy" into "y-m-d" type, and arrange and organize the data, I don't know is that always happens? but I'm feeling complicate in using "skip" and something more like part one. 
```{r}
snp_df
```

#### Part 3
clean the data in unemployment.csv
```{r}
unemp_df <- read_csv("data/unemployment.csv") |>
  janitor::clean_names() |>
  pivot_longer(
    cols = jan:dec,                 
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(
    month = month.name[match(month, tolower(month.abb))]       #Use tolower() to match the month in lowercase.
  ) |>
  arrange(year, factor(month, levels = month.name))   #Old data to new data
```


```{r}
unemp_df
```

#### Combaining all together

```{r}
final_df <- pols_df |>
  left_join(snp_df, by = c("year","month")) |>
  left_join(unemp_df, by = c("year","month"))
```

#### Conclusion
The ```pols-month``` table records the number of governors, senators, and representatives from each party during the presidential elections of different parties (Democratic/Republican).

The ```snp``` table represents stock market trends, and the ```close``` value reflects the overall stock price level of large companies.

The ```unemployment``` table represents the US unemployment rate.

We merged and then split the year and month data into the ```final_df``` table. This allows us to compare presidential party, stock market performance, and unemployment rates for a specific year and month, making it ideal for studying the relationship between politics, the economy, and employment.

The dataset spans 1947–2015 and covers many important historical events, such as the 1973–1975 oil crisis, the 1981–1982 recession, the 2000 dot-com bubble, and the 2007–2009 Great Recession. Therefore, this dataset provides significant reference value for studying the relationships between politics, the economy, and employment.

# Problem 2
```{r}
path_trash <- "data/202509 Trash Wheel Collection Data.xlsx"

mr <- read_excel(path_trash, sheet = "Mr. Trash Wheel", skip=1, range = cell_cols("A:N"))
prof <- read_excel(path_trash, sheet = "Professor Trash Wheel", skip=1, range = cell_cols("A:M"))
gwyn <- read_excel(path_trash, sheet = "Gwynns Falls Trash Wheel", skip=1, range = cell_cols("A:L"))

mr <- mr |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    wheel = "Mr. Trash Wheel",
    date = ymd(date), 
    year  = as.integer(year(date)),
    month = month.name[month(date)],                                           #in order to unify data
    sports_balls = as.integer(round(sports_balls, 0))
    ) 

prof <- prof |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    wheel = "Professor Trash Wheel",
    date = ymd(date),
    year  = as.integer(year(date)),
    month = month.name[month(date)],                                           #in order to unify data
    ) 

gwyn <- gwyn |> 
  janitor::clean_names() |> 
  filter(!is.na(dumpster)) |> 
  mutate(
    wheel = "Gwynns Falls Trash Wheel",
    date = ymd(date),
    year  = as.integer(year(date)),
    month = month.name[month(date)],                                           #in order to unify data
    ) 

final_wheels <- bind_rows(mr, prof, gwyn) |>
  arrange(date) |> 
  relocate("wheel","dumpster")

```

I successfully cleaned and combined the datasets for Mr. Trash Wheel, Professor Trash Wheel, and Gwynnda, resulting in a dataset containing `r nrow(final_wheels)` observations, with each row corresponding to a dumpster collection event.

(I didn't delete the `day` column as in Problem 1, as the event records are daily. I retained the full `date` column for better visualization. I also debated whether to delete the original `year` and `month`, but for statistical convenience, I retained them.) 

Key variables include the collection `date`, the `weight_tons` of trash collected,
the number of `cigarette_butts`, `plastic_bottles`, and `sports_balls` (rounded to integers),
as well as the estimated number of `homes_powered`.

```{r}
prof_total_weight <- final_wheels |>
  filter(wheel == "Professor Trash Wheel") |>
  summarise(total_weight = sum(weight_tons, na.rm = TRUE)) |>
  pull(total_weight)

gwyn_jun2022_cigs <- final_wheels |>
  filter(wheel == "Gwynns Falls Trash Wheel", year == 2022, month == "June") |> 
  summarise(total_cigrette_butts = sum(cigarette_butts, na.rm = TRUE)) |> 
  pull(total_cigrette_butts)
```
Across all available data, Professor Trash Wheel collected a total of `r round(prof_total_weight, 1)` tons of trash. In June 2022, Gwynnda collected `r format(gwyn_jun2022_cigs, big.mark = ",")` cigarette butts.

# Problem 3
```{r}
zip_zori <- read_csv("data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |> 
  janitor::clean_names() |>
  rename(zip_code = region_name) |> 
  select(-region_type, -state_name, -state, -city, -metro) |> 
  pivot_longer(
    cols = starts_with("x20"),
    names_to = "date",
    values_to = "rent_price"
  ) |> 
  filter(!is.na(rent_price)) |>
  mutate(
    county_name = str_replace(county_name, " County", ""),
    date = str_replace(date, "x", ""),
    date = ymd(date)
    )

zip_codes <- read_csv("data/Zip Codes.csv")


```