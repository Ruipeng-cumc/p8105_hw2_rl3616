---
title: "p8105_hw2_rl3616"
author: "Ruipeng Li"
date: "`r format(Sys.Date())`"
output: github_document
---
Loading packages. 
```{r}
library(tidyverse)
library(lubridate)      #to use parse_date_time
```

# Problem 1

#### Part 1
Clean the data in pols-month.csv.

```{r}
pols_df <- read_csv("data/pols-month.csv") |>
  janitor::clean_names() |>
  separate(mon, into = c("year", "month", "day"), convert = TRUE) |>
  mutate(
    month = month.name[month],
    president = ifelse(prez_gop == 1, "gop", "dem")
    ) |>
  select(-prez_gop, -prez_dem, -day) |> 
  arrange(year, factor(month, levels = tolower(month.name)))   #Old data to new data
```

Finished part one, let's looking at our new pols-month.

```{r}
pols_df
```

#### Part 2
clean the data in snp.csv
This is pretty complicate since we both have yyyy/m/d type of date and m/d/yy

```{r}
snp_df <- read_csv("data/snp.csv") |>
  janitor::clean_names() |>
  mutate(date = parse_date_time(date, orders = c("ymd", "mdy"))) |>     
  separate(date, into = c("year", "month", "day"), convert = TRUE) |>
  mutate(
    year  = if_else(year > 2015, year - 100L, year),
    month = month.name[month]
    ) |> 
  select(-day) |> 
  arrange(year, factor(month, levels = tolower(month.name)))   #Old data to new data
```

I found "parse_date_time()" in lubridate package can both help me clean the "ymd" and "mdy" into "y-m-d" type, and arrange and organize the data, I don't know is that always happens? but I'm feeling complicate in using "skip" and something more like part one. 
```{r}
snp_df
```

#### Part 3
clean the data in unemployment.csv
```{r}
unemp_df <- read_csv("data/unemployment.csv") |>
  janitor::clean_names() |>
  pivot_longer(
    cols = jan:dec,                 
    names_to = "month",
    values_to = "unemployment"
  ) |>
  mutate(
    month = month.name[match(month, tolower(month.abb))]       #Use tolower() to match the month in lowercase.
  ) |>
  select(year, month, unemployment) |>
  arrange(year, factor(month, levels = tolower(month.name)))   #Old data to new data
```


```{r}
unemp_df
```

#### Combaining all together

```{r}
final_df <- pols_df |>
  left_join(snp_df, by = c("year","month")) |>
  left_join(unemp_df, by = c("year","month"))


knitr::kable(head(final_df, 20))      #Just checking our data.

final_df <- final_df |>
  arrange(desc(year), desc(month))

knitr::kable(head(final_df, 20))      #Checking from new to old data.
```

#### Conclusion
The ```pols-month``` table records the number of governors, senators, and representatives from each party during the presidential elections of different parties (Democratic/Republican).

The ```snp``` table represents stock market trends, and the ```close``` value reflects the overall stock price level of large companies.

The ```unemployment``` table represents the US unemployment rate.

We merged and then split the year and month data into the ```final_df``` table. This allows us to compare presidential party, stock market performance, and unemployment rates for a specific year and month, making it ideal for studying the relationship between politics, the economy, and employment.

The dataset spans 1947–2015 and covers many important historical events, such as the 1973–1975 oil crisis, the 1981–1982 recession, the 2000 dot-com bubble, and the 2007–2009 Great Recession. Therefore, this dataset provides significant reference value for studying the relationships between politics, the economy, and employment.
